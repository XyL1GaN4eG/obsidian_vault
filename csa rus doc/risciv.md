# Документация набора инструкций RiscIv (ISA)

RiscIv ISA - это простой регистровый набор инструкций, вдохновленный архитектурой RISC-V. В этой документации представлен обзор инструкций, доступных в RiscIv ISA, их синтаксис и семантика.

Комментарии в ассемблерном коде RiscIv обозначаются символом `;`.

Вдохновлено [RISC-V](https://riscv.org/wp-content/uploads/2017/05/riscv-spec-v2.2.pdf)

## Директивы перемещения непосредственных значений

Язык ассемблера RiscIv предоставляет специальные директивы для работы с большими непосредственными значениями, которые не помещаются в стандартные форматы инструкций:

- **%hi(symbol)**
    - **Описание:** Используется для извлечения старших 20 бит 32-битного адреса или непосредственного значения
    - **Использование:** `lui rd, %hi(symbol)`
    - **Операция:** `rd <- (symbol & 0xFFFFF000)`

- **%lo(symbol)**
    - **Описание:** Используется для извлечения младших 12 бит 32-битного адреса или непосредственного значения
    - **Использование:** `addi rd, rs, %lo(symbol)`
    - **Операция:** `rd <- rs + (symbol & 0x00000FFF)`

Эти директивы обычно используются вместе для загрузки полного 32-битного адреса в регистр:

```assembly
lui  a0, %hi(address)    ; Загрузить старшие 20 бит в a0
addi a0, a0, %lo(address) ; Добавить младшие 12 бит к a0
```

## Инструкции

Размер инструкции: 4 байта.

### Инструкции перемещения данных

- **Загрузить верхнее непосредственное значение**
    - **Синтаксис:** `lui <rd>, <k>`
    - **Описание:** Загрузить непосредственное значение, сдвинутое влево на 12 бит, в регистр назначения.
    - **Операция:** `rd <- k << 12`

- **Перемещение**
    - **Синтаксис:** `mv <rd>, <rs>`
    - **Описание:** Переместить значение из исходного регистра в регистр назначения.
    - **Операция:** `rd <- rs`

- **Сохранить слово**
    - **Синтаксис:** `sw <rs2>, <offset>(<rs1>)`
    - **Описание:** Сохранить значение из исходного регистра в память по адресу, вычисленному путем добавления смещения к базовому регистру.
    - **Операция:** `M[offset + rs1] <- rs2`

- **Сохранить байт**
    - **Синтаксис:** `sb <rs2>, <offset>(<rs1>)`
    - **Описание:** Сохранить младшие 8 бит значения из исходного регистра в память по адресу, вычисленному путем добавления смещения к базовому регистру.
    - **Операция:** `M[offset + rs1] <- rs2 & 0xFF`

- **Загрузить слово**
    - **Синтаксис:** `lw <rd>, <offset>(<rs1>)`
    - **Описание:** Загрузить слово из памяти по адресу, вычисленному путем добавления смещения к базовому регистру, в регистр назначения.
    - **Операция:** `rd <- M[offset + rs1]`

### Арифметические инструкции

- **Добавить непосредственное значение**
    - **Синтаксис:** `addi <rd>, <rs1>, <k>`
    - **Описание:** Добавить непосредственное значение к исходному регистру и сохранить результат в регистре назначения. Сохраняются только младшие 12 бит результата (старшие 20 бит устанавливаются в зависимости от знака непосредственного значения).
    - **Операция:** `rd <- rs1 + k`

- **Сложение**
    - **Синтаксис:** `add <rd>, <rs1>, <rs2>`
    - **Описание:** Сложить значения двух исходных регистров и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 + rs2`

- **Вычитание**
    - **Синтаксис:** `sub <rd>, <rs1>, <rs2>`
    - **Описание:** Вычесть значение второго исходного регистра из первого исходного регистра и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 - rs2`

- **Умножение**
    - **Синтаксис:** `mul <rd>, <rs1>, <rs2>`
    - **Описание:** Умножить значения двух исходных регистров и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 * rs2`

- **Умножение с сохранением старшей части**
    - **Синтаксис:** `mulh <rd>, <rs1>, <rs2>`
    - **Описание:** Умножить значения двух исходных регистров и сохранить старшую часть результата в регистре назначения.
    - **Операция:** `rd <- (rs1 * rs2) >> (размер слова)`

- **Деление**
    - **Синтаксис:** `div <rd>, <rs1>, <rs2>`
    - **Описание:** Разделить значение первого исходного регистра на значение второго исходного регистра и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 / rs2`

- **Остаток от деления**
    - **Синтаксис:** `rem <rd>, <rs1>, <rs2>`
    - **Описание:** Вычислить остаток от деления первого исходного регистра на второй исходный регистр и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 % rs2`

### Битовые инструкции

- **Логический сдвиг влево**
    - **Синтаксис:** `sll <rd>, <rs1>, <rs2>`
    - **Описание:** Сдвинуть значение первого исходного регистра влево на количество бит, указанное во втором исходном регистре, и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 << rs2`

- **Логический сдвиг вправо**
    - **Синтаксис:** `srl <rd>, <rs1>, <rs2>`
    - **Описание:** Сдвинуть значение первого исходного регистра вправо на количество бит, указанное во втором исходном регистре, и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 >> rs2`

- **Арифметический сдвиг вправо**
    - **Синтаксис:** `sra <rd>, <rs1>, <rs2>`
    - **Описание:** Сдвинуть значение первого исходного регистра вправо на количество бит, указанное во втором исходном регистре, с сохранением знака, и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 >> rs2`

- **Битовое И**
    - **Синтаксис:** `and <rd>, <rs1>, <rs2>`
    - **Описание:** Выполнить битовую операцию И над значениями двух исходных регистров и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 & rs2`

- **Битовое ИЛИ**
    - **Синтаксис:** `or <rd>, <rs1>, <rs2>`
    - **Описание:** Выполнить битовую операцию ИЛИ над значениями двух исходных регистров и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 | rs2`

- **Битовое исключающее ИЛИ**
    - **Синтаксис:** `xor <rd>, <rs1>, <rs2>`
    - **Описание:** Выполнить битовую операцию исключающего ИЛИ над значениями двух исходных регистров и сохранить результат в регистре назначения.
    - **Операция:** `rd <- rs1 ^ rs2`

### Инструкции управления потоком

- **Прыжок**
    - **Синтаксис:** `j <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд.
    - **Операция:** `pc <- pc + k`

- **Прыжок и связь**
    - **Синтаксис:** `jal <rd>, <k>`
    - **Описание:** Сохранить адрес следующей инструкции в регистре назначения и перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд.
    - **Операция:** `rd <- pc + 4, pc <- pc + k`

- **Прыжок по регистру**
    - **Синтаксис:** `jr <rs>`
    - **Описание:** Перейти по адресу, хранящемуся в исходном регистре.
    - **Операция:** `pc <- rs`

- **Ветвление если равно нулю**
    - **Синтаксис:** `beqz <rs1>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если значение в исходном регистре равно нулю.
    - **Операция:** `if rs1 == 0 then pc <- pc + k`

- **Ветвление если не равно нулю**
    - **Синтаксис:** `bnez <rs1>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если значение в исходном регистре не равно нулю.
    - **Операция:** `if rs1 != 0 then pc <- pc + k`

- **Ветвление если больше**
    - **Синтаксис:** `bgt <rs1>, <rs2>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если значение в первом исходном регистре больше значения во втором исходном регистре.
    - **Операция:** `if rs1 > rs2 then pc <- pc + k`

- **Ветвление если меньше или равно**
    - **Синтаксис:** `ble <rs1>, <rs2>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если значение в первом исходном регистре меньше или равно значению во втором исходном регистре.
    - **Операция:** `if rs1 <= rs2 then pc <- pc + k`

- **Ветвление если больше (беззнаковое)**
    - **Синтаксис:** `bgtu <rs1>, <rs2>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если беззнаковое значение в первом исходном регистре больше беззнакового значения во втором исходном регистре.
    - **Операция:** `if rs1 > rs2 then pc <- pc + k`

- **Ветвление если меньше или равно (беззнаковое)**
    - **Синтаксис:** `bleu <rs1>, <rs2>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если беззнаковое значение в первом исходном регистре меньше или равно беззнаковому значения во втором исходном регистре.
    - **Операция:** `if rs1 <= rs2 then pc <- pc + k`

- **Ветвление если равно**
    - **Синтаксис:** `beq <rs1>, <rs2>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если значение в первом исходном регистре равно значению во втором исходном регистре.
    - **Операция:** `if rs1 == rs2 then pc <- pc + k`

- **Ветвление если не равно**
    - **Синтаксис:** `bne <rs1>, <rs2>, <k>`
    - **Описание:** Перейти по адресу, вычисленному путем добавления непосредственного значения к текущему счетчику команд, если значение в первом исходном регистре не равно значению во втором исходном регистре.
    - **Операция:** `if rs1 != rs2 then pc <- pc + k`

- **Останов**
    - **Синтаксис:** `halt`
    - **Описание:** Остановить машину.

## Представление состояния ISA

- `<reg>:dec`, `<reg>:hex` -- Просмотр значения конкретного регистра в десятичном или шестнадцатеричном формате.

Доступные регистры: `Zero`, `Ra`, `Sp`, `Gp`, `Tp`, `T0`, `T1`, `T2`, `S0Fp`, `S1`, `A0`, `A1`, `A2`, `A3`, `A4`, `A5`, `A6`, `A7`, `S2`, `S3`, `S4`, `S5`, `S6`, `S7`, `S8`, `S9`, `S10`, `S11`, `T3`, `T4`, `T5`, `T6`.